%aside.control-sidebar.control-sidebar-light#theme-editor
  = link_to "#", "data-toggle": "control-sidebar", class: 'aside-close' do
    .label.bg-gray
      X
  %ul.nav.nav-tabs
    %li.active
      %a{"aria-expanded" => "true", "data-toggle" => "tab", :href => "#editor_theme_tab_1"}
        %i.fa.fa-code
    %li
      %a{"aria-expanded" => "false", "data-toggle" => "tab", :href => "#editor_theme_tab_2"}
        %i.fa.fa-tint
  .tab-content.container-files.bg-gray
    #editor_theme_tab_1.tab-pane.active
      - @files_list.each_with_index do |file, i|
        - if file[:folder].eql?("html")
          .box.box-solid
            .box-header.with-border{title: "#{file[:name]}"}
              .row
                .col-lg-12
                  %h4.box-title
                    %i.fa.fa-code
                    = truncate(file[:name], length: 30, omission: '...')
            .box-body.no-padding
              .back-file-xs
                .center
                  - if file[:cover].nil?
                    %i.fa.fa-code#font-icon-size
                  - else
                    = image_tag file[:cover]
            .box-body
              %span.box-title
                = file[:size]
                %button.btn.btn-default.pull-right{onclick: "copyHtml('#{file[:id]}')"}
                  %textarea.hidden{id: "#{file[:id]}", value: "#{file[:html]}"}
                  %i.fa.fa-save
    #editor_theme_tab_2.tab-pane
      - @files_bootstrap.each_with_index do |file, i|
        .box.box-solid
          .box-header.with-border{title: "#{file[:name]}"}
            .row
              .col-lg-12
                %h4.box-title
                  %i.fa.fa-tint
                  = truncate(file[:name], length: 30, omission: '...')
          .box-body.no-padding
            .back-file-xs
              .center
                - if file[:cover].nil?
                  %i.fa.fa-tint#font-icon-size
                - else
                  = image_tag file[:cover]
          .box-body
            %span.box-title
              = file[:size]
              %button.btn.btn-default.pull-right{onclick: "copyHtml('#{file[:id]}')"}
                %textarea.hidden{id: "#{file[:id]}", value: "#{file[:html]}"}
                %i.fa.fa-save
.control-sidebar-bg

:javascript
  $('a[data-toggle="tab"]').on('shown.bs.tab', function (ev) {
    var tab = ev.target.innerText;
    var id = `#{@partial.id}`;

    if (tab === '') {
      tab = `#{@partial.underscore_name}.html.erb`
    }

    $(document).bind('keydown', function(e) {
      if(e.ctrlKey && (e.which == 83)) {
        e.preventDefault();
        save()
      }
    });

    function save() {
      if ( tab === `#{@partial.underscore_name}.html.erb`) {
        codePartialHTML.savePartial(id);
      } else if (tab === `#{@partial.underscore_name}.scss`) {
        codePartialCSS.savePartial(id);
      } else if (tab === `#{@partial.name}.js`) {
        codePartialJs.savePartial(id);
      }
    }
  })
