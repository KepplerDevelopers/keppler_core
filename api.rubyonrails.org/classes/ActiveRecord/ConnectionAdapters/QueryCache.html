<!DOCTYPE html>
<html lang="en">
<head>
    <title>ActiveRecord::ConnectionAdapters::QueryCache</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="https://api.rubyonrails.org/css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="https://api.rubyonrails.org/css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="https://api.rubyonrails.org/css/github.css" type="text/css" media="screen" />
<script src="https://api.rubyonrails.org/js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://api.rubyonrails.org/js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="https://api.rubyonrails.org/js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>


    <meta property="og:title" value="ActiveRecord::ConnectionAdapters::QueryCache">

  

    <meta name="keywords" content="ActiveRecord::ConnectionAdapters::QueryCache class">
  
    <meta name="keywords" content="dirties_query_cache, new, cache, enable_query_cache!, disable_query_cache!, uncached, clear_query_cache, select_all">
  
</head>

<body>
    <div class="banner">
        
            <span>Ruby on Rails 5.2.1</span><br />
        
        <h1>
            <span class="type">Module</span>
            ActiveRecord::ConnectionAdapters::QueryCache
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/activerecord/lib/active_record/connection_adapters/abstract/query_cache_rb.html">activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">MODULE</span>
          <a href="QueryCache/ConnectionPoolConfiguration.html">ActiveRecord::ConnectionAdapters::QueryCache::ConnectionPoolConfiguration</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="QueryCache.html#method-i-cache">cache</a>,
              </li>
            
              
              <li>
                <a href="QueryCache.html#method-i-clear_query_cache">clear_query_cache</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="QueryCache.html#method-c-dirties_query_cache">dirties_query_cache</a>,
              </li>
            
              
              <li>
                <a href="QueryCache.html#method-i-disable_query_cache-21">disable_query_cache!</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="QueryCache.html#method-i-enable_query_cache-21">enable_query_cache!</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="QueryCache.html#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="QueryCache.html#method-i-select_all">select_all</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>U</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="QueryCache.html#method-i-uncached">uncached</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    
      <!-- Section attributes -->
      <div class="sectiontitle">Attributes</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>query_cache</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>query_cache_enabled</td>
            <td class='attr-desc'></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-dirties_query_cache">
            
              <b>dirties_query_cache</b>(base, *method_names)
            
            <a href="QueryCache.html#method-c-dirties_query_cache" name="method-c-dirties_query_cache" class="permalink">Link</a>
          </div>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-dirties_query_cache_source')" id="l_method-c-dirties_query_cache_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L16" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-dirties_query_cache_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb, line 16</span>
        <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">dirties_query_cache</span>(<span class="ruby-identifier">base</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">method_names</span>)
          <span class="ruby-identifier">method_names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method_name</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">base</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-identifier">&lt;&lt;-end_code</span>, <span class="ruby-keyword">__FILE__</span>, <span class="ruby-keyword">__LINE__</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
<span class="ruby-value">              def #{method_name}(*)
                clear_query_cache if @query_cache_enabled
                super
              end
</span><span class="ruby-identifier">            end_code</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <b>new</b>(*)
            
            <a href="QueryCache.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </div>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L51" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb, line 51</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-operator">*</span>)
  <span class="ruby-keyword">super</span>
  <span class="ruby-ivar">@query_cache</span>         = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>, <span class="ruby-identifier">sql</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">sql</span>] = {} }
  <span class="ruby-ivar">@query_cache_enabled</span> = <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-cache">
            
              <b>cache</b>()
            
            <a href="QueryCache.html#method-i-cache" name="method-i-cache" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Enable the query cache within the block.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-cache_source')" id="l_method-i-cache_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L58" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-cache_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb, line 58</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cache</span>
  <span class="ruby-identifier">old</span>, <span class="ruby-ivar">@query_cache_enabled</span> = <span class="ruby-ivar">@query_cache_enabled</span>, <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-ivar">@query_cache_enabled</span> = <span class="ruby-identifier">old</span>
  <span class="ruby-identifier">clear_query_cache</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@query_cache_enabled</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-clear_query_cache">
            
              <b>clear_query_cache</b>()
            
            <a href="QueryCache.html#method-i-clear_query_cache" name="method-i-clear_query_cache" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Clears the query cache.</p>

<p>One reason you may wish to call this method explicitly is between queries
that ask the database to randomize results. Otherwise the cache would see
the same SQL query and repeatedly return the same result each time,
silently undermining the randomness you were expecting.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-clear_query_cache_source')" id="l_method-i-clear_query_cache_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L89" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-clear_query_cache_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb, line 89</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">clear_query_cache</span>
  <span class="ruby-ivar">@lock</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
    <span class="ruby-ivar">@query_cache</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-disable_query_cache-21">
            
              <b>disable_query_cache!</b>()
            
            <a href="QueryCache.html#method-i-disable_query_cache-21" name="method-i-disable_query_cache-21" class="permalink">Link</a>
          </div>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-disable_query_cache-21_source')" id="l_method-i-disable_query_cache-21_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L70" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-disable_query_cache-21_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb, line 70</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">disable_query_cache!</span>
  <span class="ruby-ivar">@query_cache_enabled</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">clear_query_cache</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-enable_query_cache-21">
            
              <b>enable_query_cache!</b>()
            
            <a href="QueryCache.html#method-i-enable_query_cache-21" name="method-i-enable_query_cache-21" class="permalink">Link</a>
          </div>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-enable_query_cache-21_source')" id="l_method-i-enable_query_cache-21_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L66" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-enable_query_cache-21_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb, line 66</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">enable_query_cache!</span>
  <span class="ruby-ivar">@query_cache_enabled</span> = <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-select_all">
            
              <b>select_all</b>(arel, name = nil, binds = [], preparable: nil)
            
            <a href="QueryCache.html#method-i-select_all" name="method-i-select_all" class="permalink">Link</a>
          </div>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-select_all_source')" id="l_method-i-select_all_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L95" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-select_all_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">select_all</span>(<span class="ruby-identifier">arel</span>, <span class="ruby-identifier">name</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">binds</span> = [], <span class="ruby-value">preparable:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@query_cache_enabled</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">locked?</span>(<span class="ruby-identifier">arel</span>)
    <span class="ruby-identifier">arel</span> = <span class="ruby-identifier">arel_from_relation</span>(<span class="ruby-identifier">arel</span>)
    <span class="ruby-identifier">sql</span>, <span class="ruby-identifier">binds</span> = <span class="ruby-identifier">to_sql_and_binds</span>(<span class="ruby-identifier">arel</span>, <span class="ruby-identifier">binds</span>)
    <span class="ruby-identifier">cache_sql</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">binds</span>) { <span class="ruby-keyword">super</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">binds</span>, <span class="ruby-value">preparable:</span> <span class="ruby-identifier">preparable</span>) }
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">super</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-uncached">
            
              <b>uncached</b>()
            
            <a href="QueryCache.html#method-i-uncached" name="method-i-uncached" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Disable the query cache within the block.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-uncached_source')" id="l_method-i-uncached_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L76" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-uncached_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb, line 76</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">uncached</span>
  <span class="ruby-identifier">old</span>, <span class="ruby-ivar">@query_cache_enabled</span> = <span class="ruby-ivar">@query_cache_enabled</span>, <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-ivar">@query_cache_enabled</span> = <span class="ruby-identifier">old</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
  </body>
</html>
