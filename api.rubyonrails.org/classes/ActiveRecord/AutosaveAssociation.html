<!DOCTYPE html>
<html lang="en">
<head>
    <title>ActiveRecord::AutosaveAssociation</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="https://api.rubyonrails.org/css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="https://api.rubyonrails.org/css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="https://api.rubyonrails.org/css/github.css" type="text/css" media="screen" />
<script src="https://api.rubyonrails.org/js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://api.rubyonrails.org/js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="https://api.rubyonrails.org/js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>


    <meta property="og:title" value="ActiveRecord::AutosaveAssociation">

  
    
    <meta name="description" content="Active Record Autosave Association  AutosaveAssociation is a module that takes care of automatically saving associated records when their parent is saved.">
    <meta property="og:description" content="Active Record Autosave Association  AutosaveAssociation is a module that takes care of automatically saving associated records when their parent is saved.">
  

    <meta name="keywords" content="ActiveRecord::AutosaveAssociation class">
  
</head>

<body>
    <div class="banner">
        
            <span>Ruby on Rails 5.2.1</span><br />
        
        <h1>
            <span class="type">Module</span>
            ActiveRecord::AutosaveAssociation
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/activerecord/lib/active_record/autosave_association_rb.html">activerecord/lib/active_record/autosave_association.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h1 id="module-ActiveRecord::AutosaveAssociation-label-Active+Record+Autosave+Association">Active Record Autosave Association</h1>

<p><a href="AutosaveAssociation.html">AutosaveAssociation</a> is a module that
takes care of automatically saving associated records when their parent is
saved. In addition to saving, it also destroys any associated records that
were marked for destruction. (See mark_for_destruction and
marked_for_destruction?).</p>

<p>Saving of the parent, its associations, and the destruction of marked
associations, all happen inside a transaction. This should never leave the
database in an inconsistent state.</p>

<p>If validations for any of the associations fail, their error messages will
be applied to the parent.</p>

<p>Note that it also means that associations marked for destruction won&#39;t
be destroyed directly. They will however still be marked for destruction.</p>

<p>Note that <code>autosave: false</code> is not same as not declaring
<code>:autosave</code>. When the <code>:autosave</code> option is not
present then new association records are saved but the updated association
records are not saved.</p>

<h2 id="module-ActiveRecord::AutosaveAssociation-label-Validation">Validation</h2>

<p>Child records are validated unless <code>:validate</code> is
<code>false</code>.</p>

<h2 id="module-ActiveRecord::AutosaveAssociation-label-Callbacks"><a href="Callbacks.html">Callbacks</a></h2>

<p>Association with autosave option defines several callbacks on your model
(before_save, after_create, after_update). Please note that callbacks are
executed in the order they were defined in model. You should avoid
modifying the association content, before autosave callbacks are executed.
Placing your callbacks after associations is usually a good practice.</p>

<h3 id="module-ActiveRecord::AutosaveAssociation-label-One-to-one+Example">One-to-one Example</h3>

<pre><code>class Post &lt; ActiveRecord::Base
  has_one :author, autosave: true
end
</code></pre>

<p>Saving changes to the parent and its associated model can now be performed
automatically <em>and</em> atomically:</p>

<pre><code>post = Post.find(1)
post.title       # =&gt; &quot;The current global position of migrating ducks&quot;
post.author.name # =&gt; &quot;alloy&quot;

post.title = &quot;On the migration of ducks&quot;
post.author.name = &quot;Eloy Duran&quot;

post.save
post.reload
post.title       # =&gt; &quot;On the migration of ducks&quot;
post.author.name # =&gt; &quot;Eloy Duran&quot;
</code></pre>

<p>Destroying an associated model, as part of the parent&#39;s save action, is
as simple as marking it for destruction:</p>

<pre><code>post.author.mark_for_destruction
post.author.marked_for_destruction? # =&gt; true
</code></pre>

<p>Note that the model is <em>not</em> yet removed from the database:</p>

<pre><code>id = post.author.id
Author.find_by(id: id).nil? # =&gt; false

post.save
post.reload.author # =&gt; nil
</code></pre>

<p>Now it <em>is</em> removed from the database:</p>

<pre><code>Author.find_by(id: id).nil? # =&gt; true
</code></pre>

<h3 id="module-ActiveRecord::AutosaveAssociation-label-One-to-many+Example">One-to-many Example</h3>

<p>When <code>:autosave</code> is not declared new children are saved when
their parent is saved:</p>

<pre><code>class Post &lt; ActiveRecord::Base
  has_many :comments # :autosave option is not declared
end

post = Post.new(title: &#39;ruby rocks&#39;)
post.comments.build(body: &#39;hello world&#39;)
post.save # =&gt; saves both post and comment

post = Post.create(title: &#39;ruby rocks&#39;)
post.comments.build(body: &#39;hello world&#39;)
post.save # =&gt; saves both post and comment

post = Post.create(title: &#39;ruby rocks&#39;)
post.comments.create(body: &#39;hello world&#39;)
post.save # =&gt; saves both post and comment
</code></pre>

<p>When <code>:autosave</code> is true all children are saved, no matter
whether they are new records or not:</p>

<pre><code>class Post &lt; ActiveRecord::Base
  has_many :comments, autosave: true
end

post = Post.create(title: &#39;ruby rocks&#39;)
post.comments.create(body: &#39;hello world&#39;)
post.comments[0].body = &#39;hi everyone&#39;
post.comments.build(body: &quot;good morning.&quot;)
post.title += &quot;!&quot;
post.save # =&gt; saves both post and comments.
</code></pre>

<p>Destroying one of the associated models as part of the parent&#39;s save
action is as simple as marking it for destruction:</p>

<pre><code>post.comments # =&gt; [#&lt;Comment id: 1, ...&gt;, #&lt;Comment id: 2, ...]&gt;
post.comments[1].mark_for_destruction
post.comments[1].marked_for_destruction? # =&gt; true
post.comments.length # =&gt; 2
</code></pre>

<p>Note that the model is <em>not</em> yet removed from the database:</p>

<pre><code>id = post.comments.last.id
Comment.find_by(id: id).nil? # =&gt; false

post.save
post.reload.comments.length # =&gt; 1
</code></pre>

<p>Now it <em>is</em> removed from the database:</p>

<pre><code>Comment.find_by(id: id).nil? # =&gt; true
</code></pre>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
    
    
    
  
</div>

    </div>
  </body>
</html>
