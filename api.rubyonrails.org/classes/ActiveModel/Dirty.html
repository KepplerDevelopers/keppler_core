<!DOCTYPE html>
<html lang="en">
<head>
    <title>ActiveModel::Dirty</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="https://api.rubyonrails.org/css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="https://api.rubyonrails.org/css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="https://api.rubyonrails.org/css/github.css" type="text/css" media="screen" />
<script src="https://api.rubyonrails.org/js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://api.rubyonrails.org/js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="https://api.rubyonrails.org/js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>


    <meta property="og:title" value="ActiveModel::Dirty">

  
    
    <meta name="description" content="Active Model Dirty  Provides a way to track changes in your object in the same way as Active Record does.">
    <meta property="og:description" content="Active Model Dirty  Provides a way to track changes in your object in the same way as Active Record does.">
  

    <meta name="keywords" content="ActiveModel::Dirty class">
  
    <meta name="keywords" content="changed?, changed, restore_attributes, clear_changes_information, clear_attribute_changes, changed_attributes, changes, previous_changes">
  
</head>

<body>
    <div class="banner">
        
            <span>Ruby on Rails 5.2.1</span><br />
        
        <h1>
            <span class="type">Module</span>
            ActiveModel::Dirty
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/activemodel/lib/active_model/dirty_rb.html">activemodel/lib/active_model/dirty.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h2 id="module-ActiveModel::Dirty-label-Active+Model+Dirty">Active Model Dirty</h2>

<p>Provides a way to track changes in your object in the same way as Active
Record does.</p>

<p>The requirements for implementing <a
href="Dirty.html">ActiveModel::Dirty</a> are:</p>
<ul><li>
<p><code>include ActiveModel::Dirty</code> in your object.</p>
</li><li>
<p>Call <code>define_attribute_methods</code> passing each method you want to
track.</p>
</li><li>
<p>Call <code>[attr_name]_will_change!</code> before each change to the
tracked attribute.</p>
</li><li>
<p>Call <code>changes_applied</code> after the changes are persisted.</p>
</li><li>
<p>Call <code>clear_changes_information</code> when you want to reset the
changes information.</p>
</li><li>
<p>Call <code>restore_attributes</code> when you want to restore previous
data.</p>
</li></ul>

<p>A minimal implementation could be:</p>

<pre><code>class Person
  include ActiveModel::Dirty

  define_attribute_methods :name

  def initialize
    @name = nil
  end

  def name
    @name
  end

  def name=(val)
    name_will_change! unless val == @name
    @name = val
  end

  def save
    # do persistence work

    changes_applied
  end

  def reload!
    # get the values from the persistence layer

    clear_changes_information
  end

  def rollback!
    restore_attributes
  end
end
</code></pre>

<p>A newly instantiated <code>Person</code> object is unchanged:</p>

<pre><code>person = Person.new
person.changed? # =&gt; false
</code></pre>

<p>Change the name:</p>

<pre><code>person.name = &#39;Bob&#39;
person.changed?       # =&gt; true
person.name_changed?  # =&gt; true
person.name_changed?(from: nil, to: &quot;Bob&quot;) # =&gt; true
person.name_was       # =&gt; nil
person.name_change    # =&gt; [nil, &quot;Bob&quot;]
person.name = &#39;Bill&#39;
person.name_change    # =&gt; [nil, &quot;Bill&quot;]
</code></pre>

<p>Save the changes:</p>

<pre><code>person.save
person.changed?      # =&gt; false
person.name_changed? # =&gt; false
</code></pre>

<p>Reset the changes:</p>

<pre><code>person.previous_changes         # =&gt; {&quot;name&quot; =&gt; [nil, &quot;Bill&quot;]}
person.name_previously_changed? # =&gt; true
person.name_previous_change     # =&gt; [nil, &quot;Bill&quot;]
person.reload!
person.previous_changes         # =&gt; {}
</code></pre>

<p>Rollback the changes:</p>

<pre><code>person.name = &quot;Uncle Bob&quot;
person.rollback!
person.name          # =&gt; &quot;Bill&quot;
person.name_changed? # =&gt; false
</code></pre>

<p>Assigning the same value leaves the attribute unchanged:</p>

<pre><code>person.name = &#39;Bill&#39;
person.name_changed? # =&gt; false
person.name_change   # =&gt; nil
</code></pre>

<p>Which attributes have changed?</p>

<pre><code>person.name = &#39;Bob&#39;
person.changed # =&gt; [&quot;name&quot;]
person.changes # =&gt; {&quot;name&quot; =&gt; [&quot;Bill&quot;, &quot;Bob&quot;]}
</code></pre>

<p>If an attribute is modified in-place then make use of
<code>[attribute_name]_will_change!</code> to mark that the attribute is
changing. Otherwise Active Model can&#39;t track changes to in-place
attributes. Note that Active Record can detect in-place modifications
automatically. You do not need to call
<code>[attribute_name]_will_change!</code> on Active Record models.</p>

<pre><code>person.name_will_change!
person.name_change # =&gt; [&quot;Bill&quot;, &quot;Bill&quot;]
person.name &lt;&lt; &#39;y&#39;
person.name_change # =&gt; [&quot;Bill&quot;, &quot;Billy&quot;]
</code></pre>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="Dirty.html#method-i-changed">changed</a>,
              </li>
            
              
              <li>
                <a href="Dirty.html#method-i-changed-3F">changed?</a>,
              </li>
            
              
              <li>
                <a href="Dirty.html#method-i-changed_attributes">changed_attributes</a>,
              </li>
            
              
              <li>
                <a href="Dirty.html#method-i-changes">changes</a>,
              </li>
            
              
              <li>
                <a href="Dirty.html#method-i-clear_attribute_changes">clear_attribute_changes</a>,
              </li>
            
              
              <li>
                <a href="Dirty.html#method-i-clear_changes_information">clear_changes_information</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="Dirty.html#method-i-previous_changes">previous_changes</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="Dirty.html#method-i-restore_attributes">restore_attributes</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  
    <!-- Includes -->
    <div class="sectiontitle">Included Modules</div>
    <ul>
      
        <li>
          
            <a href="AttributeMethods.html">
              ActiveModel::AttributeMethods
            </a>
          
        </li>
      
    </ul>
  



  

    

    

    


    


    <!-- Methods -->
    
    
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-changed">
            
              <b>changed</b>()
            
            <a href="Dirty.html#method-i-changed" name="method-i-changed" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns an array with the name of the attributes with unsaved changes.</p>

<pre><code>person.changed # =&gt; []
person.name = &#39;bob&#39;
person.changed # =&gt; [&quot;name&quot;]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-changed_source')" id="l_method-i-changed_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activemodel/lib/active_model/dirty.rb#L168" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-changed_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activemodel/lib/active_model/dirty.rb, line 168</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">changed</span>
  <span class="ruby-identifier">changed_attributes</span>.<span class="ruby-identifier">keys</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-changed-3F">
            
              <b>changed?</b>()
            
            <a href="Dirty.html#method-i-changed-3F" name="method-i-changed-3F" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns <code>true</code> if any of the attributes have unsaved changes,
<code>false</code> otherwise.</p>

<pre><code>person.changed? # =&gt; false
person.name = &#39;bob&#39;
person.changed? # =&gt; true
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-changed-3F_source')" id="l_method-i-changed-3F_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activemodel/lib/active_model/dirty.rb#L159" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-changed-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activemodel/lib/active_model/dirty.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">changed?</span>
  <span class="ruby-identifier">changed_attributes</span>.<span class="ruby-identifier">present?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-changed_attributes">
            
              <b>changed_attributes</b>()
            
            <a href="Dirty.html#method-i-changed_attributes" name="method-i-changed_attributes" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns a hash of the attributes with unsaved changes indicating their
original values like <code>attr =&gt; original value</code>.</p>

<pre><code>person.name # =&gt; &quot;bob&quot;
person.name = &#39;robert&#39;
person.changed_attributes # =&gt; {&quot;name&quot; =&gt; &quot;bob&quot;}
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-changed_attributes_source')" id="l_method-i-changed_attributes_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activemodel/lib/active_model/dirty.rb#L216" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-changed_attributes_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activemodel/lib/active_model/dirty.rb, line 216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">changed_attributes</span>
  <span class="ruby-comment"># This should only be set by methods which will call changed_attributes</span>
  <span class="ruby-comment"># multiple times when it is known that the computed value cannot change.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@cached_changed_attributes</span>)
    <span class="ruby-ivar">@cached_changed_attributes</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">attributes_changed_by_setter</span>.<span class="ruby-identifier">reverse_merge</span>(<span class="ruby-identifier">mutations_from_database</span>.<span class="ruby-identifier">changed_values</span>).<span class="ruby-identifier">freeze</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-changes">
            
              <b>changes</b>()
            
            <a href="Dirty.html#method-i-changes" name="method-i-changes" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns a hash of changed attributes indicating their original and new
values like <code>attr =&gt; [original value, new value]</code>.</p>

<pre><code>person.changes # =&gt; {}
person.name = &#39;bob&#39;
person.changes # =&gt; { &quot;name&quot; =&gt; [&quot;bill&quot;, &quot;bob&quot;] }
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-changes_source')" id="l_method-i-changes_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activemodel/lib/active_model/dirty.rb#L232" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-changes_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activemodel/lib/active_model/dirty.rb, line 232</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">changes</span>
  <span class="ruby-identifier">cache_changed_attributes</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">HashWithIndifferentAccess</span>[<span class="ruby-identifier">changed</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">attr</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">attr</span>, <span class="ruby-identifier">attribute_change</span>(<span class="ruby-identifier">attr</span>)] }]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-clear_attribute_changes">
            
              <b>clear_attribute_changes</b>(attr_names)
            
            <a href="Dirty.html#method-i-clear_attribute_changes" name="method-i-clear_attribute_changes" class="permalink">Link</a>
          </div>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-clear_attribute_changes_source')" id="l_method-i-clear_attribute_changes_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activemodel/lib/active_model/dirty.rb#L203" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-clear_attribute_changes_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activemodel/lib/active_model/dirty.rb, line 203</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">clear_attribute_changes</span>(<span class="ruby-identifier">attr_names</span>)
  <span class="ruby-identifier">attributes_changed_by_setter</span>.<span class="ruby-identifier">except!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">attr_names</span>)
  <span class="ruby-identifier">attr_names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attr_name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">clear_attribute_change</span>(<span class="ruby-identifier">attr_name</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-clear_changes_information">
            
              <b>clear_changes_information</b>()
            
            <a href="Dirty.html#method-i-clear_changes_information" name="method-i-clear_changes_information" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Clears all dirty data: current changes and previous changes.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-clear_changes_information_source')" id="l_method-i-clear_changes_information_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activemodel/lib/active_model/dirty.rb#L195" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-clear_changes_information_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activemodel/lib/active_model/dirty.rb, line 195</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">clear_changes_information</span>
  <span class="ruby-ivar">@previously_changed</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@mutations_before_last_save</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@attributes_changed_by_setter</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">forget_attribute_assignments</span>
  <span class="ruby-ivar">@mutations_from_database</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-previous_changes">
            
              <b>previous_changes</b>()
            
            <a href="Dirty.html#method-i-previous_changes" name="method-i-previous_changes" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Returns a hash of attributes that were changed before the model was saved.</p>

<pre><code>person.name # =&gt; &quot;bob&quot;
person.name = &#39;robert&#39;
person.save
person.previous_changes # =&gt; {&quot;name&quot; =&gt; [&quot;bob&quot;, &quot;robert&quot;]}
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-previous_changes_source')" id="l_method-i-previous_changes_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activemodel/lib/active_model/dirty.rb#L244" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-previous_changes_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activemodel/lib/active_model/dirty.rb, line 244</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">previous_changes</span>
  <span class="ruby-ivar">@previously_changed</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@previously_changed</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">mutations_before_last_save</span>.<span class="ruby-identifier">changes</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-restore_attributes">
            
              <b>restore_attributes</b>(attributes = changed)
            
            <a href="Dirty.html#method-i-restore_attributes" name="method-i-restore_attributes" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>Restore all previous data of the provided attributes.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-restore_attributes_source')" id="l_method-i-restore_attributes_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/activemodel/lib/active_model/dirty.rb#L190" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-restore_attributes_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activemodel/lib/active_model/dirty.rb, line 190</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">restore_attributes</span>(<span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">changed</span>)
  <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">attr</span><span class="ruby-operator">|</span> <span class="ruby-identifier">restore_attribute!</span> <span class="ruby-identifier">attr</span> }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
  </body>
</html>
