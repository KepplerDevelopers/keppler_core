<!DOCTYPE html>
<html lang="en">
<head>
    <title>ActionDispatch::Session::CookieStore</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="https://api.rubyonrails.org/css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="https://api.rubyonrails.org/css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="https://api.rubyonrails.org/css/github.css" type="text/css" media="screen" />
<script src="https://api.rubyonrails.org/js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://api.rubyonrails.org/js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="https://api.rubyonrails.org/js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>


    <meta property="og:title" value="ActionDispatch::Session::CookieStore">

  
    
    <meta name="description" content="This cookie-based session store is the Rails default. It is dramatically faster than the alternatives.">
    <meta property="og:description" content="This cookie-based session store is the Rails default. It is dramatically faster than the alternatives.">
  

    <meta name="keywords" content="ActionDispatch::Session::CookieStore class">
  
    <meta name="keywords" content="new, delete_session, load_session">
  
</head>

<body>
    <div class="banner">
        
            <span>Ruby on Rails 5.2.1</span><br />
        
        <h1>
            <span class="type">Class</span>
            ActionDispatch::Session::CookieStore
            
                <span class="parent">&lt;
                    
                    <a href="AbstractStore.html">ActionDispatch::Session::AbstractStore</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/actionpack/lib/action_dispatch/middleware/session/cookie_store_rb.html">actionpack/lib/action_dispatch/middleware/session/cookie_store.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>This cookie-based session store is the Rails default. It is dramatically
faster than the alternatives.</p>

<p>Sessions typically contain at most a user_id and flash message; both fit
within the 4K cookie size limit. A CookieOverflow exception is raised if
you attempt to store more than 4K of data.</p>

<p>The cookie jar used for storage is automatically configured to be the best
possible option given your application&#39;s configuration.</p>

<p>If you only have secret_token set, your cookies will be signed, but not
encrypted. This means a user cannot alter their <code>user_id</code>
without knowing your app&#39;s secret key, but can easily read their
<code>user_id</code>. This was the default for Rails 3 apps.</p>

<p>Your cookies will be encrypted using your apps secret_key_base. This goes a
step further than signed cookies in that encrypted cookies cannot be
altered or read by users. This is the default starting in Rails 4.</p>

<p>Configure your session store in
<code>config/initializers/session_store.rb</code>:</p>

<pre><code>Rails.application.config.session_store :cookie_store, key: &#39;_your_app_session&#39;
</code></pre>

<p>By default, your secret key base is derived from your application name in
the test and development environments. In all other environments, it is
stored encrypted in the <code>config/credentials.yml.enc</code> file.</p>

<p>If your application was not updated to Rails 5.2 defaults, the
secret_key_base will be found in the old <code>config/secrets.yml</code>
file.</p>

<p>Note that changing your secret_key_base will invalidate all existing
session. Additionally, you should take care to make sure you are not
relying on the ability to decode signed cookies generated by your app in
external applications or JavaScript before changing it.</p>

<p>Because <a href="CookieStore.html">CookieStore</a> extends
Rack::Session::Abstract::Persisted, many of the options described there can
be used to customize the session cookie that is generated. For example:</p>

<pre><code>Rails.application.config.session_store :cookie_store, expire_after: 14.days
</code></pre>

<p>would set the session cookie to expire automatically 14 days after
creation. Other useful options include <code>:key</code>,
<code>:secure</code> and <code>:httponly</code>.</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="CookieStore.html#method-i-delete_session">delete_session</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="CookieStore.html#method-i-load_session">load_session</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="CookieStore.html#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <b>new</b>(app, options = {})
            
            <a href="CookieStore.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </div>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/actionpack/lib/action_dispatch/middleware/session/cookie_store.rb#L54" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/action_dispatch/middleware/session/cookie_store.rb, line 54</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">cookie_only:</span> <span class="ruby-keyword">true</span>))
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-delete_session">
            
              <b>delete_session</b>(req, session_id, options)
            
            <a href="CookieStore.html#method-i-delete_session" name="method-i-delete_session" class="permalink">Link</a>
          </div>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-delete_session_source')" id="l_method-i-delete_session_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/actionpack/lib/action_dispatch/middleware/session/cookie_store.rb#L58" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-delete_session_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/action_dispatch/middleware/session/cookie_store.rb, line 58</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delete_session</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">session_id</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">new_sid</span> = <span class="ruby-identifier">generate_sid</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:drop</span>]
  <span class="ruby-comment"># Reset hash and Assign the new session id</span>
  <span class="ruby-identifier">req</span>.<span class="ruby-identifier">set_header</span>(<span class="ruby-string">&quot;action_dispatch.request.unsigned_session_cookie&quot;</span>, <span class="ruby-identifier">new_sid</span> <span class="ruby-operator">?</span> { <span class="ruby-string">&quot;session_id&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">new_sid</span> } <span class="ruby-operator">:</span> {})
  <span class="ruby-identifier">new_sid</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-load_session">
            
              <b>load_session</b>(req)
            
            <a href="CookieStore.html#method-i-load_session" name="method-i-load_session" class="permalink">Link</a>
          </div>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-load_session_source')" id="l_method-i-load_session_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/fc5dd0b85189811062c85520fd70de8389b55aeb/actionpack/lib/action_dispatch/middleware/session/cookie_store.rb#L65" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-load_session_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/action_dispatch/middleware/session/cookie_store.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">load_session</span>(<span class="ruby-identifier">req</span>)
  <span class="ruby-identifier">stale_session_check!</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">unpacked_cookie_data</span>(<span class="ruby-identifier">req</span>)
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">persistent_session_id!</span>(<span class="ruby-identifier">data</span>)
    [<span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;session_id&quot;</span>], <span class="ruby-identifier">data</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
  </body>
</html>
